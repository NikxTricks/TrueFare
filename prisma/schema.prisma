// prisma/schema.prisma

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ENUM Definitions
enum DriverStatus {
  Active
  Inactive
}

enum PaymentMethod {
  Cash
  Card
  UPI
}

enum TripStatus {
  Pending
  Ongoing
  Completed
  Canceled
}

// Models

model User {
  id        Int      @id @default(autoincrement())
  googleId  String   @unique
  name      String
  email     String   @unique
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  Rider     Rider?
  Driver    Driver?
}

model Driver {
  id         Int          @id @default(autoincrement())
  status     DriverStatus @default(Inactive)
  disabled   Boolean      @default(false)
  location   Json?        // { "type": "Point", "coordinates": [longitude, latitude] }
  userID     Int          @unique
  createdAt  DateTime     @default(now())
  updatedAt  DateTime     @updatedAt

  User       User      @relation(fields: [userID], references: [id])
  Trips      Trip[]    @relation("DriverTrips")
}

model Rider {
  id                Int       @id @default(autoincrement())
  location          Json?     // { "type": "Point", "coordinates": [longitude, latitude] }
  lastKnownLocation Json?     // { "type": "Point", "coordinates": [longitude, latitude] }
  disabled          Boolean   @default(false)
  userID            Int       @unique
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt

  User              User      @relation(fields: [userID], references: [id])
  Trips             Trip[]    @relation("RiderTrips")
}

model Trip {
  id          Int         @id @default(autoincrement())
  status      TripStatus  @default(Pending)
  source      Json?       // { "type": "Point", "coordinates": [longitude, latitude] }
  destination Json?       // { "type": "Point", "coordinates": [longitude, latitude] }
  riderID     Int?
  driverID    Int?
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt

  Rider       Rider?      @relation("RiderTrips", fields: [riderID], references: [id])
  Driver      Driver?     @relation("DriverTrips", fields: [driverID], references: [id])
  Payment     Payment?
}

model Payment {
  id        Int          @id @default(autoincrement())
  method    PaymentMethod
  amount    Float
  tripID    Int          @unique
  createdAt DateTime     @default(now())
  updatedAt DateTime     @updatedAt

  Trip      Trip         @relation(fields: [tripID], references: [id])
}